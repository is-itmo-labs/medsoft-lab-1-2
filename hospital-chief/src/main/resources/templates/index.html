<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Hospital Chief</title>
</head>
<body class="p-8">
<div class="max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Главврач — Список пациентов</h1>
    <ul id="list" class="space-y-2"></ul>
</div>

<script>
    const apiBase = window.location.origin; // предполагаем HIS.Srv раздаёт UI
    async function load() {
      const res = await fetch(apiBase + '/api/patients');
      const patients = await res.json();
      render(patients);
    }
    function render(patients) {
      const ul = document.getElementById('list');
      ul.innerHTML = '';
      patients.forEach(p => {
        const li = document.createElement('li');
        li.className = "border p-3 rounded";
        li.innerHTML = `<b>${p.firstName} ${p.lastName}</b><div class="text-sm">DOB: ${p.birthDate} | id: ${p.id}</div>`;
        ul.appendChild(li);
      });
    }

    load();

    // WebSocket
    const wsProto = (location.protocol === 'https:') ? 'wss://' : 'ws://';
    const ws = new WebSocket(wsProto + location.host + '/ws/patients');
    ws.onmessage = (ev) => {
      try {
        const msg = JSON.parse(ev.data);
        if (msg.type === 'new') {
          // добавить пациента в список
          const ul = document.getElementById('list');
          const p = msg.patient;
          const li = document.createElement('li');
          li.className = "border p-3 rounded bg-yellow-50";
          li.innerHTML = `<b>${p.firstName} ${p.lastName}</b><div class="text-sm">DOB: ${p.birthDate} | id: ${p.id}</div>`;
          ul.prepend(li);
        }
      } catch (ex) { console.error(ex) }
    }
</script>
</body>
</html>
